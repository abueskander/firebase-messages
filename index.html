<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>رسائل المستخدمين</title>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
    <style>
        body {
            font-family: sans-serif;
            background: #e5ddd5;
            padding: 20px;
        }
        #messageForm {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px #ccc;
            margin-bottom: 20px;
        }
        #messages div {
            background: #dcf8c6;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        input, textarea {
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
        }
        button {
            padding: 10px 20px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h2>إرسال رسالة</h2>
    <form id="messageForm">
        <input type="text" id="phone" placeholder="رقم التليفون" required><br>
        <textarea id="content" placeholder="اكتب رسالتك..." required></textarea><br>
        <button type="submit">إرسال</button>
    </form>

    <h3>الرسائل:</h3>
    <div id="messages"></div>

    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCIuNrBGfVLKL-Rd1eHBSJAVyEIemfSwZ4",
        authDomain: "togareloctock1.firebaseapp.com",
        projectId: "togareloctock1",
        storageBucket: "togareloctock1.firebasestorage.app",
        messagingSenderId: "693317989397",
        appId: "1:693317989397:web:d5c5cffb30311ba92aca1c",
        measurementId: "G-DK722FT6L5"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      const messageForm = document.getElementById("messageForm");
      const phoneInput = document.getElementById("phone");
      const contentInput = document.getElementById("content");
      const messagesDiv = document.getElementById("messages");

      messageForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const phone = phoneInput.value;
        const content = contentInput.value;
        const timestamp = new Date();

        await db.collection("messages").add({
          phone,
          content,
          timestamp
        });

        phoneInput.value = "";
        contentInput.value = "";
      });

      db.collection("messages").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
        messagesDiv.innerHTML = "";
        snapshot.forEach((doc) => {
          const msg = doc.data();
          const div = document.createElement("div");
          const date = msg.timestamp?.toDate?.().toLocaleString() || "";
          div.innerHTML = `<strong>${msg.phone}</strong><br>${msg.content}<br><small>${date}</small>`;
          messagesDiv.appendChild(div);
        });
      });
    </script>
</body>
</html>
